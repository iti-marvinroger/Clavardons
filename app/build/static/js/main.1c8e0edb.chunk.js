(window["webpackJsonp@clavardons/app"]=window["webpackJsonp@clavardons/app"]||[]).push([[0],{15:function(e,n,t){e.exports=t.p+"static/media/logo.a78800c7.svg"},34:function(e,n,t){e.exports=t(49)},44:function(e,n,t){},49:function(e,n,t){"use strict";t.r(n);var r,o,a,c=t(0),u=t.n(c),s=t(26),i=t.n(s),l=t(3),d=t(6),f=t.n(d),m=t(11),g={auth:{loading:!1,loggedIn:!1,token:"",user:{id:"id",name:"John DOE"},updateLoading:Object(l.b)(function(e,n){e.loading=n}),updateLoggedIn:Object(l.b)(function(e,n){e.loggedIn=n}),updateToken:Object(l.b)(function(e,n){e.token=n}),updateUser:Object(l.b)(function(e,n){e.user=n}),handleConnection:Object(l.e)(function(e,n){r=n}),loginWithName:Object(l.e)(function(){var e=Object(m.a)(f.a.mark(function e(n,t){var o;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Logging in with name"),e.next=3,r.invoke("LoginWithName",t);case 3:o=e.sent,n.updateToken(o.token),n.updateUser({id:o.userId,name:o.name}),n.updateLoggedIn(!0),a=o.token,window.localStorage.setItem("token",a),console.log("Success");case 9:case"end":return e.stop()}var a},e)}));return function(n,t){return e.apply(this,arguments)}}()),loginWithToken:Object(l.e)(function(){var e=Object(m.a)(f.a.mark(function e(n,t){var o;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Logging in with stored token"),e.next=3,r.invoke("LoginWithToken",t);case 3:if((o=e.sent).success){e.next=7;break}return console.log("Could not connect with the stored token"),e.abrupt("return");case 7:n.updateToken(o.token),n.updateUser({id:o.userId,name:o.name}),n.updateLoggedIn(!0),console.log("Success");case 11:case"end":return e.stop()}},e)}));return function(n,t){return e.apply(this,arguments)}}()),logout:Object(l.e)(function(){var e=Object(m.a)(f.a.mark(function e(n,t,o){var a,c;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.getStoreActions,console.log("Logging out..."),e.next=4,r.invoke("Logout");case 4:n.updateLoggedIn(!1),(c=a()).messages.clearMessages(),c.users.clearUsers(),window.localStorage.removeItem("token"),console.log("Success");case 10:case"end":return e.stop()}},e)}));return function(n,t,r){return e.apply(this,arguments)}}()),onConnectionUp:Object(l.f)(function(e,n){return n.connection.updateIsConnected},function(e,n){if(n.payload){var t=window.localStorage.getItem("token");t&&e.loginWithToken(t)}})},connection:{url:"",connected:!1,updateUrl:Object(l.b)(function(e,n){e.url=n}),updateIsConnected:Object(l.b)(function(e,n){e.connected=n}),handleConnection:Object(l.e)(function(e,n,t){var r=t.getState;function o(){return a.apply(this,arguments)}function a(){return(a=Object(m.a)(f.a.mark(function t(){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("Connecting to ".concat(r().url,"...")),t.next=4,n.start();case 4:e.updateIsConnected(!0),console.log("Connection successful"),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("Cannot connect!",t.t0),setTimeout(function(){return o()},5e3);case 12:case"end":return t.stop()}},t,null,[[0,8]])}))).apply(this,arguments)}n.onclose(Object(m.a)(f.a.mark(function n(){return f.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.updateIsConnected(!1),n.next=3,o();case 3:case"end":return n.stop()}},n)}))),o()})},messages:{messages:[],addMessages:Object(l.b)(function(e,n){e.messages=e.messages.concat(n)}),clearMessages:Object(l.b)(function(e){e.messages=[]}),sendMessage:Object(l.e)(function(){var e=Object(m.a)(f.a.mark(function e(n,t){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sending message..."),e.next=3,o.invoke("SendMessage",t);case 3:console.log("Message sent");case 4:case"end":return e.stop()}},e)}));return function(n,t){return e.apply(this,arguments)}}()),handleConnection:Object(l.e)(function(e,n){(o=n).on("ReceiveMessage",function(n){console.log("Receiving message..."),e.addMessages([{id:n.id,text:n.text,userId:n.userId,userName:n.userName}])}),o.on("StopSpamming",function(e){console.log("Stop spamming!"),window.alert("Clavardons avec respect\xae, arr\xeate de spammer.")})})},users:{users:{},addUser:Object(l.b)(function(e,n){e.users[n.id]=n}),removeUser:Object(l.b)(function(e,n){delete e.users[n]}),clearUsers:Object(l.b)(function(e){e.users={}}),handleConnection:Object(l.e)(function(e,n){(a=n).on("AddUser",function(n){console.log("Receiving new user..."),e.addUser(n)}),a.on("RemoveUser",function(n){console.log("Deleting user user..."),e.removeUser(n.id)})})}},p=Object(l.c)(g),b=Object(l.d)(),h=b.useStoreActions,v=(b.useStoreDispatch,b.useStoreState),x=t(17),w=(t(44),t(8)),j=t(7),O={colors:{main:"#100382",placeholder:"#bdc3c7",selfMessage:"#4A4453",otherMessage:"#9A89B4"}},k=t(16),E=t(4);function S(){var e=Object(w.a)(["\n  display: flex;\n  box-sizing: border-box;\n\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return S=function(){return e},e}var y=j.b.div(S(),E.a,E.b,E.c,E.d,E.e);function C(){var e=Object(w.a)(["\n  display: flex;\n\n  ","\n  ","\n"]);return C=function(){return e},e}var I=j.b.form(C(),E.c,E.e);function M(){var e=Object(w.a)(["\n  ","\n  ","\n  ","\n  ","\n"]);return M=function(){return e},e}var U=j.b.span(M(),E.b,E.c,E.e,E.f);function D(){var e=Object(w.a)(["\n  ","\n  ","\n\n  padding: 5px;\n\n  border: 1px solid ",";\n  outline: none;\n  border-radius: 3px;\n"]);return D=function(){return e},e}var L=j.b.input(D(),E.c,E.e,function(e){return e.theme.colors.placeholder});function T(){var e=Object(w.a)(["\n  ","\n  ","\n  ","\n"]);return T=function(){return e},e}var A=j.b.img(T(),E.c,E.d,E.e),N=t(15),W=t.n(N);function G(){var e=Object(w.a)(["\n  ","\n  ","\n\n  height: 30px;\n\n  background-color: ",";\n  border: none;\n  color: white;\n  border-radius: 3px;\n  outline: none;\n"]);return G=function(){return e},e}var R=j.b.button(G(),E.c,E.e,function(e){return e.theme.colors.main}),H=u.a.memo(function(e){var n=v(function(e){return e.auth.user}),t=Object(c.useMemo)(function(){return e.user.id===n.id},[e.user.id,n]);return u.a.createElement(y,{p:2,mb:1,display:t?"none":"flex",bg:"otherMessage",color:"white",style:{boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)",overflowX:"hidden",flexShrink:0,maxHeight:100}},u.a.createElement(U,null,e.user.name))}),J=u.a.memo(function(e){var n=v(function(e){return e.auth.user}),t=Object(c.useMemo)(function(){return e.message.userId===n.id},[e.message.userId,n]),r=Object(c.useMemo)(function(){return t?"selfMessage":"otherMessage"},[t]),o=Object(c.useMemo)(function(){return t?"flex-end":"flex-start"},[t]);return u.a.createElement(y,{mb:3,flexDirection:"column",alignSelf:o,maxWidth:[200,300,400]},u.a.createElement(y,{flexDirection:"column",maxHeight:50,style:{overflow:"hidden"}},u.a.createElement(U,{alignSelf:o,color:"placeholder"},e.message.userName)),u.a.createElement(y,{mt:1,p:3,bg:r,borderRadius:3,style:{overflow:"hidden",boxShadow:"0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23)"}},u.a.createElement(U,{color:"white"},e.message.text)))}),B=function(){var e=Object(c.useState)(""),n=Object(k.a)(e,2),t=n[0],r=n[1],o=Object(c.useState)(!1),a=Object(k.a)(o,2),s=a[0],i=a[1],l=v(function(e){return e.auth.user}),d=v(function(e){return e.messages.messages}),g=v(function(e){return e.users.users}),p=h(function(e){return e.messages.sendMessage}),b=h(function(e){return e.auth.logout}),x=Object(c.useCallback)(function(e){r(e.target.value)},[]),w=Object(c.useCallback)(function(){var e=Object(m.a)(f.a.mark(function e(n){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),i(!0),e.prev=2,e.next=5,p(t);case 5:r(""),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),window.alert(e.t0);case 11:i(!1);case 12:case"end":return e.stop()}},e,null,[[2,8]])}));return function(n){return e.apply(this,arguments)}}(),[t,p]),j=Object(c.useCallback)(function(){b()},[b]);return u.a.createElement(y,{flexDirection:"column",flexGrow:1,alignSelf:"stretch"},u.a.createElement(y,{p:3,justifyContent:["center","space-between"],alignItems:"center",style:{boxShadow:"2px 2px 5px rgba(0, 0, 0, .2)"}},u.a.createElement(A,{src:W.a,height:50}),u.a.createElement(y,{display:["none","flex"],alignItems:"center"},u.a.createElement(y,null,"A toi le clavardage, ",l.name," !"),u.a.createElement(R,{ml:2,onClick:j},"D\xe9connexion"))),u.a.createElement(y,{flexGrow:1,style:{overflow:"hidden"}},u.a.createElement(y,{flexDirection:"column",flexGrow:1},u.a.createElement(y,{p:3,flexDirection:"column-reverse",flexGrow:1,style:{overflowY:"auto"}},u.a.createElement(y,{flexDirection:"column"},d.map(function(e){return u.a.createElement(J,{key:e.id,message:e})}))),u.a.createElement(I,{p:2,onSubmit:w},u.a.createElement(L,{value:t,onChange:x,flexGrow:1}),u.a.createElement(R,{ml:2,type:"submit",disabled:s},"Envoyer"))),u.a.createElement(y,{p:3,display:["none","flex"],width:[0,200,300],style:{boxShadow:"0px 0px 5px rgba(0, 0, 0, .2)",overflowY:"auto"},flexDirection:"column"},Object.values(g).map(function(e){return u.a.createElement(H,{key:e.id,user:e})}))))},P=function(){return u.a.createElement(y,{flexDirection:"column",alignItems:"center"},u.a.createElement(A,{src:W.a,width:300}),u.a.createElement(U,{mt:3},"Connexion au serveur en cours.."))},Y=function(){var e=Object(c.useState)(""),n=Object(k.a)(e,2),t=n[0],r=n[1],o=v(function(e){return e.auth.loading}),a=h(function(e){return e.auth.loginWithName}),s=Object(c.useCallback)(function(e){r(e.target.value)},[]),i=Object(c.useCallback)(function(e){e.preventDefault(),a(t)},[t,a]);return u.a.createElement(y,{flexDirection:"column"},u.a.createElement(A,{src:W.a,width:300}),!o&&u.a.createElement(I,{onSubmit:i,mt:3},u.a.createElement(L,{placeholder:"Ton nom",value:t,onChange:s,flexGrow:1,mr:3}),u.a.createElement(R,{type:"submit"},"Clavardons !")))},z=function(){var e=v(function(e){return e.auth.loggedIn}),n=v(function(e){return e.connection.connected}),t=Object(c.useMemo)(function(){return n?e?B:Y:P},[e,n]);return u.a.createElement(t,null)};function X(){var e=Object(w.a)(["\n  display: flex;\n\n  width: 100vw;\n  height: 100vh;\n\n  justify-content: center;\n  align-items: center;\n"]);return X=function(){return e},e}var _,q=j.b.div(X()),F=function(){return u.a.createElement(l.a,{store:p},u.a.createElement(j.a,{theme:O},u.a.createElement(q,null,u.a.createElement(z,null))))},K=new URLSearchParams(window.location.search).get("server_url")||"http://127.0.0.1:5000",Q=(_=K,(new x.a).configureLogging(x.c.None).withUrl(_).withHubProtocol(new x.b).build()),V=p.getActions();V.connection.updateUrl(K),V.connection.handleConnection(Q),V.auth.handleConnection(Q),V.messages.handleConnection(Q),V.users.handleConnection(Q),i.a.render(u.a.createElement(F,null),document.getElementById("root"))}},[[34,1,2]]]);
//# sourceMappingURL=main.1c8e0edb.chunk.js.map